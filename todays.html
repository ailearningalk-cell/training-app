<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Today's & Tomorrow's Programs</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
  <div class="page">
    <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back</a>

    <!-- Today -->
    <div class="card card-today">
      <h2 id="today-title">Today</h2>
      <div id="today-programs">Loading...</div>
    </div>

    <!-- Tomorrow -->
    <div class="card card-tomorrow">
      <h2 id="tomorrow-title">Tomorrow</h2>
      <div id="tomorrow-programs">Loading...</div>
    </div>
  </div>

  <script>
    const API_KEY = "AIzaSyB1VwkzfKyybV_QeC8AQDPHSkBPRqfKH2g";
    const SHEET_ID = "1229350699";
    const SHEET_NAME = "Programs"; // renamed tab
    const RANGE = "A1:D"; // Date, Day, Name, Venue

    const todayEl = document.getElementById("today-programs");
    const tomorrowEl = document.getElementById("tomorrow-programs");

    const todayTitle = document.getElementById("today-title");
    const tomorrowTitle = document.getElementById("tomorrow-title");

    // Format date like: 19-Aug-25 [Tuesday]
    function formatDate(date) {
      const options = { weekday: 'long', day: '2-digit', month: 'short', year: '2-digit' };
      return date.toLocaleDateString('en-GB', options)
        .replace(',', '')
        .replace(/(\d{2}) (\w{3}) (\d{2}) (\w+)/, "$1-$2-$3 [$4]");
    }

    async function loadData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}!${RANGE}?key=${API_KEY}&nocache=${Date.now()}`;

      try {
        const res = await fetch(url, { cache: "no-store" });
        const data = await res.json();

        if (!data.values || data.values.length < 2) {
          todayEl.innerHTML = '<div class="no-training">No training today</div>';
          tomorrowEl.innerHTML = '<div class="no-training">No training tomorrow</div>';
          return;
        }

        const rows = data.values;
        const headers = rows[0];
        const records = rows.slice(1);

        const today = new Date();
        const tomorrow = new Date();
        tomorrow.setDate(today.getDate() + 1);

        const todayStr = today.toLocaleDateString("en-GB");
        const tomorrowStr = tomorrow.toLocaleDateString("en-GB");

        todayTitle.textContent = `Today: ${formatDate(today)}`;
        tomorrowTitle.textContent = `Tomorrow: ${formatDate(tomorrow)}`;

        renderPrograms(records, todayStr, todayEl);
        renderPrograms(records, tomorrowStr, tomorrowEl);

      } catch (err) {
        todayEl.innerHTML = '<div class="no-training">Error loading data</div>';
        tomorrowEl.innerHTML = '<div class="no-training">Error loading data</div>';
        console.error(err);
      }
    }

    function renderPrograms(records, matchDate, container) {
      const filtered = records.filter(r => {
        let d = new Date(r[0]).toLocaleDateString("en-GB");
        return d === matchDate;
      });

      if (filtered.length === 0) {
        container.innerHTML = '<div class="no-training">No training</div>';
        return;
      }

      let table = `<table class="styled-table">
        <tr>
          <th>Sl. No</th>
          <th>Day</th>
          <th>Name of the Training</th>
          <th>Venue</th>
        </tr>`;

      filtered.forEach((r, i) => {
        let dayCell = r[1] || "";
        if (/\[Opening\]|\[Closing\]/i.test(dayCell)) {
          dayCell = `<span class="badge-highlight">${dayCell}</span>`;
        }

        table += `<tr>
          <td class="center">${i + 1}</td>
          <td>${dayCell}</td>
          <td>${r[2] || ""}</td>
          <td>${r[3] || ""}</td>
        </tr>`;
      });

      table += "</table>";
      container.innerHTML = table;
    }

    loadData();
    setInterval(loadData, 60 * 1000); // refresh every 1 minute
  </script>
</body>
</html>
