<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Today's & Tomorrow's Programs</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Back Button -->
  <a href="index.html" class="back-btn">&#8592;</a>

  <!-- Today Block -->
  <div class="block block-today">
    <h2 id="todayHeader">Today</h2>
    <div id="todayContent">Loading...</div>
  </div>

  <!-- Tomorrow Block -->
  <div class="block block-tomorrow">
    <h2 id="tomorrowHeader">Tomorrow</h2>
    <div id="tomorrowContent">Loading...</div>
  </div>

<script>
const sheetId = "1229350699"; // Your Sheet ID
const apiKey = "AIzaSyB1VwkzfKyybV_QeC8AQDPHSkBPRqfKH2g"; // Your API Key
const sheetName = "Programs";

const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!A1:D?key=${apiKey}`;

// Format date helper
function formatDate(d) {
  const day = String(d.getDate()).padStart(2, '0');
  const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const month = months[d.getMonth()];
  const year = String(d.getFullYear()).slice(-2);
  const weekday = d.toLocaleDateString("en-US", { weekday: "long" });
  return { key: `${day}-${month}-${year}`, label: `${day}-${month}-${year} [${weekday}]` };
}

const today = new Date();
const tomorrow = new Date();
tomorrow.setDate(today.getDate() + 1);

const todayStr = formatDate(today);
const tomorrowStr = formatDate(tomorrow);

document.getElementById("todayHeader").textContent = "Today: " + todayStr.label;
document.getElementById("tomorrowHeader").textContent = "Tomorrow: " + tomorrowStr.label;

fetch(apiUrl)
  .then(res => res.json())
  .then(data => {
    if (!data.values || data.values.length < 2) {
      document.getElementById("todayContent").innerHTML = `<div class="no-training">No training today</div>`;
      document.getElementById("tomorrowContent").innerHTML = `<div class="no-training">No training tomorrow</div>`;
      return;
    }

    const rows = data.values;
    const header = rows[0];
    const entries = rows.slice(1);

    function buildTable(targetDate, containerId) {
      const filtered = entries.filter(r => r[0] && r[0].trim() === targetDate.key);
      if (filtered.length === 0) {
        document.getElementById(containerId).innerHTML = `<div class="no-training">No training</div>`;
        return;
      }

      let table = `<table class="styled-table"><thead><tr>`;
      header.forEach(h => table += `<th>${h}</th>`);
      table += `</tr></thead><tbody>`;

      filtered.forEach((r, i) => {
        let dayCell = r[1] || "";
        if (dayCell.includes("[Opening]") || dayCell.includes("[Closing]")) {
          dayCell = `<span class="highlight">${dayCell}</span>`;
        }
        table += `<tr>
          <td>${i + 1}</td>
          <td>${dayCell}</td>
          <td>${r[2] || ""}</td>
          <td>${r[3] || ""}</td>
        </tr>`;
      });

      table += `</tbody></table>`;
      document.getElementById(containerId).innerHTML = table;
    }

    buildTable(todayStr, "todayContent");
    buildTable(tomorrowStr, "tomorrowContent");
  })
  .catch(err => {
    document.getElementById("todayContent").innerHTML = `<div class="no-training">Error loading data</div>`;
    document.getElementById("tomorrowContent").innerHTML = `<div class="no-training">Error loading data</div>`;
    console.error("Error:", err);
  });

// Auto refresh every 2 minutes
setInterval(() => location.reload(), 120000);
</script>

</body>
</html>
