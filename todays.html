<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Today's & Tomorrow's Programs</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg, #3acfd5, #3a4ed5);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
      color: white;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    header h1 {
      margin: 0;
      font-size: 30px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      color: black;
    }

    .back-btn {
      position: absolute;
      top: 15px;
      left: 15px;
      font-size: 22px;
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease;
      background: rgba(255,255,255,0.2);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      border: none;
      outline: none;
    }

    .back-btn:hover {
      transform: scale(1.1);
      background: rgba(255,255,255,0.3);
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      width: 100%;
      max-width: 700px;
    }

    .card {
      background: rgba(255,255,255,0.2);
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }

    .card h2 {
      margin: 0 0 10px 0;
      text-align: center;
      font-size: 22px;
    }

    .styled-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      word-wrap: break-word;
    }

    .styled-table th, .styled-table td {
      border: 1px solid rgba(255,255,255,0.3);
      padding: 8px;
      text-align: center;
      color: rgba(0,0,0,0.75);
      font-size: 16px;
    }

    .styled-table th {
      background: rgba(255,255,255,0.25);
    }

    .styled-table td:nth-child(2) {
      text-align: left;
      word-wrap: break-word;
    }

    .details-icon {
      width: 24px;
      height: 24px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .details-icon:hover {
      transform: scale(1.2);
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      padding: 10px;
    }

    .modal-content {
      background: #fff;
      color: #000;
      padding: 20px;
      border-radius: 10px;
      width: 95%;
      max-width: 400px;
      border: 2px solid #3a4ed5;
      box-sizing: border-box;
      overflow-wrap: break-word;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal h3 {
      text-align: center;
      margin-top: 0;
    }

    .modal .date {
      text-align: center;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .modal p {
      margin: 5px 0;
      word-wrap: break-word;
    }

    .close-btn {
      display: block;
      margin: 15px auto 0 auto;
      padding: 8px 16px;
      background: #3a4ed5;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    .close-btn:hover {
      background: #2193b0;
    }

    @media screen and (max-width: 480px) {
      .card {
        padding: 10px;
      }
      .styled-table th, .styled-table td {
        font-size: 14px;
        padding: 6px;
      }
      .modal-content {
        padding: 15px;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>Programs</h1>
</header>

<button class="back-btn" onclick="goBack()" aria-label="Go back">
  <i class="fas fa-arrow-left"></i>
</button>

<div class="container">
  <div class="card">
    <h2 id="todayHeader">Today</h2>
    <div id="todayPrograms">Loading...</div>
  </div>

  <div class="card">
    <h2 id="tomorrowHeader">Tomorrow</h2>
    <div id="tomorrowPrograms">Loading...</div>
  </div>
</div>

<!-- Modal -->
<div id="detailsModal" class="modal">
  <div class="modal-content">
    <h3>Program Details</h3>
    <div class="date" id="modalDate"></div>
    <p id="modalTraining"></p>
    <p id="modalTrainers"></p>
    <p id="modalVenue"></p>
    <p id="modalRemarks"></p>
    <button class="close-btn" onclick="closeModal()">Close</button>
  </div>
</div>

<script>
function goBack() {
  window.location.href = "home.html";
}

function formatHeaderDate(dateObj) {
  const day = String(dateObj.getDate()).padStart(2,"0");
  const month = dateObj.toLocaleString("en-US",{month:"short"});
  const year = dateObj.getFullYear().toString().slice(-2);
  const weekday = dateObj.toLocaleString("en-US",{weekday:"short"});
  return `${day} ${month} ${year} [${weekday}]`;
}

function formatSheetDate(dateObj){
  const day = String(dateObj.getDate()).padStart(2,"0");
  const month = dateObj.toLocaleString("en-US",{month:"short"});
  const year = dateObj.getFullYear().toString().slice(-2);
  return `${day}-${month}-${year}`;
}

async function loadPrograms() {
  const sheetId = "1zzK9dFYAlN3acpXfUG5-Xn9PNDxK_A5G9cuvpQRY5co";
  const url = `https://opensheet.elk.sh/${sheetId}/Programs`;
  try {
    const response = await fetch(url,{cache:"no-store"});
    const data = await response.json();

    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate()+1);

    const todayStr = formatSheetDate(today);
    const tomorrowStr = formatSheetDate(tomorrow);

    document.getElementById("todayHeader").innerText = `Today: ${formatHeaderDate(today)}`;
    document.getElementById("tomorrowHeader").innerText = `Tomorrow: ${formatHeaderDate(tomorrow)}`;

    const todayPrograms = data.filter(row => row.Date === todayStr);
    const tomorrowPrograms = data.filter(row => row.Date === tomorrowStr);

    renderPrograms(todayPrograms,"todayPrograms","No training today");
    renderPrograms(tomorrowPrograms,"tomorrowPrograms","No training tomorrow");

  } catch (error){
    document.getElementById("todayPrograms").innerHTML = "<p class='no-training'>Error loading data</p>";
    document.getElementById("tomorrowPrograms").innerHTML = "<p class='no-training'>Error loading data</p>";
  }
}

function renderPrograms(programs, containerId, emptyMsg){
  const container = document.getElementById(containerId);
  if(programs.length===0){
    container.innerHTML=`<p class="no-training">${emptyMsg}</p>`;
    return;
  }

  let table = `<table class="styled-table">
  <tr><th>No</th><th>Name of the Training</th><th>Details</th></tr>`;

  programs.forEach((row,index)=>{
    const trainingName = row["Name of the Training"].replace(/\n/g,"<br>");
    const detailsIcon = `<img src="https://ailearningalk-cell.github.io/training-app/icons/details.png" class="details-icon" onclick='openModal(${JSON.stringify(row)})' alt="Details">`;

    table+=`<tr>
      <td>${index+1}</td>
      <td>${trainingName}</td>
      <td>${detailsIcon}</td>
    </tr>`;
  });

  table += `</table>`;
  container.innerHTML = table;
}

function openModal(row){
  const modal = document.getElementById("detailsModal");
  modal.style.display="flex";

  const todayDate = new Date(row.Date.split("-").join(" "));
  document.getElementById("modalDate").innerText = formatHeaderDate(todayDate);

  document.getElementById("modalTraining").innerHTML = `<strong>Name of the Training:</strong><br>${row["Name of the Training"].replace(/\n/g,"<br>")}`;

  let trainers = row.Trainers;
  if(trainers.trim()==="" || trainers.trim()==="-"){
    trainers="-";
  } else {
    // split by newlines and add numbering
    trainers = trainers.split(/\n/).filter(t=>t.trim()!=="").map((t,i)=>`${i+1} - ${t}`).join("<br>");
  }
  document.getElementById("modalTrainers").innerHTML = `<strong>Resource Persons:</strong><br>${trainers}`;

  document.getElementById("modalVenue").innerHTML = `<strong>Venue:</strong> ${row.Venue}`;
  document.getElementById("modalRemarks").innerHTML = `<strong>Remarks:</strong> ${row.Remarks}`;
}

function closeModal(){
  document.getElementById("detailsModal").style.display="none";
}

loadPrograms();
</script>

</body>
</html>
