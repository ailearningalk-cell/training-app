<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Today's & Tomorrow's Programs</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Back Button -->
  <a href="index.html" class="back-btn" aria-label="Back">&#8592;</a>

  <main class="page">
    <!-- Today Block -->
    <section class="card card-today">
      <h2 id="todayTitle">Today</h2>
      <div id="todayContent" class="table-wrap">
        <div class="loading">Loading…</div>
      </div>
    </section>

    <!-- Tomorrow Block -->
    <section class="card card-tomorrow">
      <h2 id="tomorrowTitle">Tomorrow</h2>
      <div id="tomorrowContent" class="table-wrap">
        <div class="loading">Loading…</div>
      </div>
    </section>
  </main>

  <script>
    // === Your Google Sheet config ===
    const SHEET_ID   = "1zzK9dFYAlN3acpXfUG5-Xn9PNDxK_A5G9cuvpQRY5co";
    const API_KEY    = "AIzaSyB1VwkzfKyybV_QeC8AQDPHSkBPRqfKH2g";
    const SHEET_NAME = "Programs";   // tab name
    const RANGE      = "A1:D";       // Date, Day, Name, Venue

    // Build API URL, force formatted values and bypass caches
    function apiUrl() {
      const ts = Date.now();
      return `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(SHEET_NAME)}!${RANGE}?valueRenderOption=FORMATTED_VALUE&dateTimeRenderOption=FORMATTED_STRING&key=${API_KEY}&_=${ts}`;
    }

    // Format "Today: 19-Aug-25 [Tuesday]"
    function keyAndLabel(date) {
      const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
      const day = String(d.getDate()).padStart(2, '0');
      const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      const month = months[d.getMonth()];
      const year = String(d.getFullYear()).slice(-2);
      const weekday = d.toLocaleDateString("en-US", { weekday: "long" });
      return { key: `${day}-${month}-${year}`, label: `${day}-${month}-${year} [${weekday}]` };
    }

    // Try to normalize any cell date to "DD-MMM-YY"
    function normalizeCellDate(cell) {
      if (cell == null) return null;
      const s = String(cell).trim();

      // Already looks like "19-Aug-25"
      if (/^\d{2}-[A-Za-z]{3}-\d{2}$/.test(s)) return s;

      // Try ISO (e.g., 2025-08-19) or "8/19/2025" etc.
      const maybe = new Date(s);
      if (!isNaN(maybe.getTime())) {
        const d = maybe;
        const day = String(d.getDate()).padStart(2, '0');
