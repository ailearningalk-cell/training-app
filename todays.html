<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Today's Programs</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>

  <!-- Back Button -->
  <a href="index.html" class="back-btn">&#8592;</a>

  <!-- Page Title + Date Line -->
  <header>
    <h1>Today's Programs</h1>
    <h2 id="dateLine" style="margin-top:8px;"></h2>
  </header>

  <!-- Table Container -->
  <div class="table-container">
    <table id="programsTable" class="styled-table" style="display:none;"></table>
    <div id="noDataMessage" class="no-data" style="display:none; color:red; font-weight:bold;"></div>
  </div>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR9rXqiV3oCIIuwRc1nXgwJ4DbYvtwsEAsPAbxUPWwzf_VYGnyJAhCL4TWn4LYs5TiDo13foTLTpY_g/pub?gid=1229350699&single=true&output=csv";

    // Format today like sheet (DD-MMM-YY)
    function formatSheetDate(d) {
      const dd = String(d.getDate()).padStart(2, "0");
      const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      const mmm = months[d.getMonth()];
      const yy = String(d.getFullYear()).slice(-2);
      return `${dd}-${mmm}-${yy}`;
    }

    const todayStr = formatSheetDate(new Date());
    document.getElementById("dateLine").textContent = `Training on ${todayStr}`;

    const tableEl = document.getElementById("programsTable");
    const noDataEl = document.getElementById("noDataMessage");

    Papa.parse(CSV_URL, {
      download: true,
      skipEmptyLines: true,
      complete: function (results) {
        const rows = results.data;

        // âš¡ Skip first 2 rows (A1 today(), A2 blank)
        const content = rows.slice(2);

        // If sheet says "There is no training today"
        if (content[0] && content[0][0].includes("There is no training today")) {
          tableEl.style.display = "none";
          noDataEl.style.display = "block";
          noDataEl.textContent = "No training today";
          return;
        }

        // First row now should be headers
        const headers = content[0];
        const dataRows = content.slice(1);

        // Find Day column
        const dayIndex = headers.indexOf("Day");
        if (dayIndex === -1) {
          noDataEl.style.display = "block";
          noDataEl.textContent = "Sheet format error (no Day column)";
          return;
        }

        // Filter today's rows
        const todayRows = dataRows.filter(r => r[dayIndex] === todayStr);

        if (!todayRows.length) {
          tableEl.style.display = "none";
          noDataEl.style.display = "block";
          noDataEl.textContent = "No training today";
          return;
        }

        // Build table
        let thead = "<thead><tr>";
        headers.forEach(h => thead += `<th>${h}</th>`);
        thead += "</tr></thead>";

        let tbody = "<tbody>";
        todayRows.forEach(r => {
          tbody += "<tr>";
          r.forEach(c => tbody += `<td>${c}</td>`);
          tbody += "</tr>";
        });
        tbody += "</tbody>";

        tableEl.innerHTML = thead + tbody;
        tableEl.style.display = "table";
        noDataEl.style.display = "none";
      }
    });
  </script>
</body>
</html>
