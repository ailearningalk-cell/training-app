<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Today's Programs</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
  <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>

  <div class="page">
    <div class="card card-today">
      <h2 id="todayTitle">Today</h2>
      <div id="todayContent">Loading...</div>
    </div>

    <div class="card card-tomorrow">
      <h2 id="tomorrowTitle">Tomorrow</h2>
      <div id="tomorrowContent">Loading...</div>
    </div>
  </div>

  <script>
    const apiKey = "AIzaSyB1VwkzfKyybV_QeC8AQDPHSkBPRqfKH2g";
    const sheetId = "1229350699";
    const sheetName = "Programs"; // updated sheet tab name
    const base = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${apiKey}`;

    async function fetchSheet() {
      try {
        const response = await fetch(base, { cache: "no-store" });
        const data = await response.json();

        if (!data.values || data.values.length < 2) {
          document.getElementById("todayContent").innerHTML = '<div class="no-training">No training today</div>';
          document.getElementById("tomorrowContent").innerHTML = '<div class="no-training">No training tomorrow</div>';
          return;
        }

        const rows = data.values.slice(1);
        const today = new Date();
        const tomorrow = new Date();
        tomorrow.setDate(today.getDate() + 1);

        const todayStr = today.toLocaleDateString("en-GB");
        const tomorrowStr = tomorrow.toLocaleDateString("en-GB");

        document.getElementById("todayTitle").textContent =
          `Today: ${todayStr} [${today.toLocaleDateString("en-US", { weekday: "long" })}]`;
        document.getElementById("tomorrowTitle").textContent =
          `Tomorrow: ${tomorrowStr} [${tomorrow.toLocaleDateString("en-US", { weekday: "long" })}]`;

        function render(dateStr, elementId) {
          const filtered = rows.filter(r => r[0] === dateStr);
          if (filtered.length === 0) {
            document.getElementById(elementId).innerHTML = '<div class="no-training">No training</div>';
          } else {
            let html = `<table class="styled-table"><tr>`;
            data.values[0].forEach(h => html += `<th>${h}</th>`);
            html += `</tr>`;
            filtered.forEach(r => {
              html += "<tr>";
              r.forEach(c => html += `<td>${c}</td>`);
              html += "</tr>";
            });
            html += "</table>";
            document.getElementById(elementId).innerHTML = html;
          }
        }

        render(todayStr, "todayContent");
        render(tomorrowStr, "tomorrowContent");

      } catch (e) {
        document.getElementById("todayContent").textContent = "Error loading data";
        document.getElementById("tomorrowContent").textContent = "Error loading data";
      }
    }

    fetchSheet();
  </script>
</body>

</html>
